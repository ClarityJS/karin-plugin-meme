import C from'node:path';import {fileURLToPath}from'node:url';import D,{requireFileSync,karinPathBase,copyConfigSync,filesByExt,YamlEditor,watch,getFiles,config,segment}from'node-karin';var $=Object.defineProperty;var O=(o,e)=>{for(var i in e)$(o,i,{get:e[i],enumerable:true});};var k=fileURLToPath(import.meta.url).replace(/\\/g,"/"),g=C.resolve(k,"../../").replace(/\\/g,"/"),v=C.basename(g),m=requireFileSync(`${g}/package.json`),N=Object.freeze(g.includes("node_modules")),r={get Bot_Name(){return config.pkg().name==="node-karin"?"Karin":config.pkg().name},get Bot_Version(){return config.pkg().version},get Bot_Path(){return process.cwd().replace(/\\/g,"/")},get Plugin_Path(){return g},get Plugin_Name(){return N||process.env.NODE_ENV==="development"?m.name:v},get Plugin_Config_Name(){return this.Plugin_Name.replace("/","-")},get Plugin_AliasName(){return "\u67E0\u7CD6\u8868\u60C5"},get Plugin_Version(){return m.version},get Plugin_Anthor(){return m.author}};var h=class{dirCfgPath;defCfgPath;constructor(){this.dirCfgPath=`${karinPathBase}/${r.Plugin_Config_Name}/config/`,this.defCfgPath=`${r.Plugin_Path}/config/defSet/`;}initCfg(){copyConfigSync(this.defCfgPath,this.dirCfgPath);let e=filesByExt(this.dirCfgPath,".yaml","name");for(let t of e){let s=new YamlEditor(`${this.dirCfgPath}/${t}`),n=new YamlEditor(`${this.defCfgPath}/${t}`),{differences:a,result:l}=this.mergeObjectsWithPriority(s,n);a&&l.save();}return filesByExt(this.dirCfgPath,".yaml","abs").forEach(t=>watch(t,(s,n)=>{})),this}getDefOrConfig(e){let i=this.getYaml("defSet",e),t=this.getYaml("config",e);return {...i,...t}}All(){let e={};return getFiles(this.defCfgPath,[".yaml"]).forEach(t=>{let s=C.basename(t,".yaml");e[s]=this.getDefOrConfig(s)??{};}),e}getYaml(e,i){let t=e==="config"?`${this.dirCfgPath}/${i}.yaml`:`${this.defCfgPath}/${i}.yaml`;return requireFileSync(t,{force:true})}Modify(e,i,t,s="config"){let n=s==="config"?`${this.dirCfgPath}/${e}.yaml`:`${this.defCfgPath}/${e}.yaml`,a=new YamlEditor(n);a.set(i,t),a.save();}mergeObjectsWithPriority(e,i){let t=false;return ((n,a)=>{let l=a.get(n),u=e.get(n);if(typeof u=="object"&&typeof l=="object")for(let p in l)p in u||(t=true,e.set(`${""}${p}`,l[p]));})("",i),{differences:t,result:e}}},b=new Proxy(Object.assign(new h().initCfg(),{}),{get(o,e){return e in o?Reflect.get(o,e):o.getDefOrConfig(e)}});function B(o=1){let e=b.other.renderScale||100,i=Math.min(2,Math.max(.5,e/100));return o=o*i,`style=transform:scale(${o})`}var Q={async render(o,e={}){o=o.replace(/.html$/,"");let i=`${r.Plugin_Path}/resources`,t=await D.render({type:"jpeg",encoding:"base64",name:`${o}`.replace(/\\/g,"/"),file:`${i}/${o}.html`,data:{_res_path:`${r.Plugin_Path}/resources`.replace(/\\/g,"/"),defaultLayout:`${r.Plugin_Path}/resources/common/layout/default.html`.replace(/\\/g,"/"),sys:{scale:B(e.scale??1)},copyright:`${r.Bot_Name}<span class="version"> ${r.Bot_Version}</span> & ${r.Plugin_Name}<span class="version"> ${r.Plugin_Version}`,...e},screensEval:"#containter",pageGotoParams:{waitUntil:"load",timeout:6e4}});return segment.image(`${t.startsWith("base64://")?t:`base64://${t}`}`)}};var re={server:{title:"\u670D\u52A1\u8BBE\u7F6E",cfg:{url:{title:"\u81EA\u5B9A\u4E49\u5730\u5740",desc:"\u8BBE\u7F6E\u81EA\u5B9A\u4E49\u8868\u60C5\u670D\u52A1\u5730\u5740",type:"string"},retry:{title:"\u91CD\u8BD5\u6B21\u6570",desc:"\u91CD\u8BD5\u6B21\u6570, \u9ED8\u8BA4\u4E3A3\u6B21",type:"number"},timeout:{title:"\u8D85\u65F6\u65F6\u95F4",desc:"\u8D85\u65F6\u65F6\u95F4\uFF0C\u5355\u4F4D\u4E3A\u79D2",type:"number"}}},meme:{title:"\u8868\u60C5\u8BBE\u7F6E",cfg:{enable:{title:"\u9ED8\u8BA4\u8868\u60C5",desc:"\u662F\u5426\u8BBE\u7F6E\u4E3A\u9ED8\u8BA4\u8868\u60C5",type:"boolean"},forceSharp:{title:"\u5F3A\u5236\u89E6\u53D1",desc:"\u662F\u5426\u5F3A\u5236\u4F7F\u7528#\u89E6\u53D1, \u5F00\u542F\u540E\u5FC5\u987B\u4F7F\u7528#\u89E6\u53D1",type:"boolean"},cache:{title:"\u7F13\u5B58",desc:"\u662F\u5426\u5F00\u542F\u5934\u50CF\u7F13\u5B58",type:"boolean"},reply:{title:"\u5F15\u7528\u56DE\u590D",desc:"\u662F\u5426\u5F00\u542F\u5F15\u7528\u56DE\u590D",type:"boolean"},userName:{title:"\u7528\u6237\u6635\u79F0",desc:"\u662F\u5426\u5F00\u542F\u4F7F\u7528\u7528\u6237\u6635\u79F0\uFF0C\u4E0D\u5F00\u5219\u9ED8\u8BA4\u4F7F\u7528\u8868\u60C5\u540D\u79F0",type:"boolean"},errorReply:{title:"\u9519\u8BEF\u56DE\u590D",desc:"\u662F\u5426\u5F00\u542F\u9519\u8BEF\u4FE1\u606F\u56DE\u590D",type:"boolean"}}},access:{title:"\u540D\u5355\u8BBE\u7F6E",cfg:{enable:{title:"\u540D\u5355\u9650\u5236",desc:"\u662F\u5426\u5F00\u542F\u540D\u5355\u9650\u5236",type:"boolean"},blackListEnable:{title:"\u7981\u7528\u8868\u60C5\u5217\u8868",desc:"\u662F\u5426\u5F00\u542F\u9ED1\u540D\u5355",type:"boolean"},mode:{title:"\u540D\u5355\u6A21\u5F0F",desc:"\u540D\u5355\u6A21\u5F0F\uFF0C\u4EC5\u5728\u5F00\u542F\u540D\u5355\u9650\u5236\u542F\u7528\uFF0C0\u4E3A\u767D\u540D\u5355\uFF0C1\u4E3A\u9ED1\u540D\u5355",type:"number"},userWhiteList:{title:"\u7528\u6237\u767D\u540D\u5355",desc:"\u767D\u540D\u5355\uFF0C\u767D\u540D\u5355\u6A21\u5F0F\u65F6\u751F\u6548",type:"array"},userBlackList:{title:"\u7528\u6237\u9ED1\u540D\u5355",desc:"\u7528\u6237\u9ED1\u540D\u5355\uFF0C\u9ED1\u540D\u5355\u6A21\u5F0F\u65F6\u751F\u6548",type:"array"},blackList:{title:"\u9ED1\u540D\u5355\u8868\u60C5\u5217\u8868",desc:"\u9ED1\u540D\u5355\u8868\u60C5\u5217\u8868",type:"array"}}},protect:{title:"\u8868\u60C5\u4FDD\u62A4\u8BBE\u7F6E",cfg:{enable:{title:"\u8868\u60C5\u4FDD\u62A4",desc:"\u662F\u5426\u5F00\u542F\u8868\u60C5\u4FDD\u62A4",type:"boolean"},master:{title:"\u4E3B\u4EBA\u4FDD\u62A4",desc:"\u662F\u5426\u5F00\u542F\u4E3B\u4EBA\u4FDD\u62A4",type:"boolean"},user:{title:"\u4FDD\u62A4\u7528\u6237\u5217\u8868",desc:"\u8BBE\u7F6E\u8981\u4FDD\u62A4\u7684\u7528\u6237\uFF0C\u5982123456",type:"array"},list:{title:"\u8868\u60C5\u4FDD\u62A4\u5217\u8868",desc:"\u8868\u60C5\u4FDD\u62A4\u5217\u8868",type:"array"}}},other:{title:"\u5176\u4ED6\u8BBE\u7F6E",cfg:{renderScale:{title:"\u6E32\u67D3\u7CBE\u5EA6",desc:"\u8BBE\u7F6E\u6E32\u67D3\u7CBE\u5EA6",type:"number",limit:"50-200"},autoUpdateRes:{title:"\u81EA\u52A8\u66F4\u65B0\u8D44\u6E90",desc:"\u662F\u5426\u81EA\u52A8\u66F4\u65B0\u8868\u60C5\u5305\u8D44\u6E90\uFF0C\u5F00\u542F\u540E\u6BCF\u65E5\u51CC\u6668\u4F1A\u81EA\u52A8\u66F4\u65B0",type:"boolean"}}}};
export{O as a,m as b,N as c,r as d,b as e,Q as f,re as g};