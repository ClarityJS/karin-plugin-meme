import {d,b as b$1}from'./chunk-H7SQZYP6.js';import {e,d as d$1}from'./chunk-RPTR4L7Q.js';import x,{segment,logger}from'node-karin';var g,_,y=async s=>{let e$1=await s()??[],n=e.meme.forceSharp?"^#":"^#?",a=`(${e$1.map(o=>o.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")).join("|")})`;return new RegExp(`${n}${a}(.*)`,"i")};g=await y(async()=>await d.get_meme_all_keywords()??[]);_=await y(async()=>await d.get_preset_all_keywords()??[]);var P=async()=>{g=await y(async()=>await d.get_meme_all_keywords()??[]),_=await y(async()=>await d.get_preset_all_keywords()??[]),E.reg=_,h.reg=g;},b=s=>{if(e.access.enable){let e$1=s.userId;if(e.access.mode===0&&!e.access.userWhiteList.includes(e$1))return logger.info(`[${d$1.Plugin_AliasName}] \u7528\u6237 ${e$1} \u4E0D\u5728\u767D\u540D\u5355\u4E2D\uFF0C\u8DF3\u8FC7\u751F\u6210`),false;if(e.access.mode===1&&e.access.userBlackList.includes(e$1))return logger.info(`[${d$1.Plugin_AliasName}] \u7528\u6237 ${e$1} \u5728\u9ED1\u540D\u5355\u4E2D\uFF0C\u8DF3\u8FC7\u751F\u6210`),false}return  true},$=async s=>{if(!e.access.blackListEnable||e.access.blackList.length<0)return  false;let e$1=await d.get_meme_key_by_keyword(s);return e$1&&(await Promise.all(e.access.blackList.map(async t=>await d.get_meme_key_by_keyword(t)??t))).includes(e$1)?(logger.info(`[${d$1.Plugin_AliasName}] \u8BE5\u8868\u60C5 "${e$1}" \u5728\u7981\u7528\u5217\u8868\u4E2D\uFF0C\u8DF3\u8FC7\u751F\u6210`),true):false},R=(s,e,n)=>{if(s===0&&e===0&&n){let t=n.trim();if(!/^(@\s*\d+\s*)+$/.test(t)&&!/^(#\S+\s+[^#]+(?:\s+#\S+\s+[^#]+)*)$/.test(t))return  false}return  true},h=x.command(g,async s=>{try{let[,e,n]=s.msg.match(h.reg),t=await d.get_meme_key_by_keyword(e);if(!t)return !1;let a=await d.get_meme_info(t),o=a?.min_texts??0,c=a?.max_texts??0,f=a?.min_images??0,u=a?.max_images??0,p=a?.options??null;if(!b(s)||await $(e)||!R(o,c,n))return !1;let w=await b$1.make_meme(s,t,o,c,f,u,p,n);await s.reply([segment.image(w)]);}catch(e$1){return logger.error(e$1),e.meme.errorReply?await s.reply(`[${d$1.Plugin_AliasName}]: \u751F\u6210\u8868\u60C5\u5931\u8D25, \u9519\u8BEF\u4FE1\u606F: ${e$1.message}`):true}},{name:"\u67E0\u7CD6\u8868\u60C5:\u8868\u60C5\u5408\u6210",priority:-1/0,event:"message",permission:"all"}),E=x.command(_,async s=>{if(!e.meme.enable)return  false;try{let[,e,n]=s.msg.match(E.reg),t=await d.get_preset_key_by_keyword(e);if(!t)return !1;let a=await d.get_meme_info(t),o=a?.min_texts??0,c=a?.max_texts??0,f=a?.min_images??0,u=a?.max_images??0,p=a?.options??null;if(!b(s)||await $(e)||!R(o,c,n))return !1;let w=await b$1.make_meme(s,t,o,c,f,u,p,n,!0);await s.reply([segment.image(w)]);}catch(e$1){return logger.error(e$1),e.meme.errorReply?await s.reply(`[${d$1.Plugin_AliasName}]: \u751F\u6210\u8868\u60C5\u5931\u8D25, \u9519\u8BEF\u4FE1\u606F: ${e$1.message}`):true}},{name:"\u67E0\u7CD6\u8868\u60C5:\u9884\u8BBE\u8868\u60C5\u5408\u6210",priority:-1/0,event:"message",permission:"all"});await P();export{P as a,h as b,E as c};