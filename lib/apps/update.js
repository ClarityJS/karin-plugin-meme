import {a}from'../chunk-BUIVC4HH.js';import {d as d$1}from'../chunk-H7SQZYP6.js';import {c,d,e}from'../chunk-RPTR4L7Q.js';import m,{logger,common,restart,updatePkg,updateGitPlugin}from'node-karin';async function f(t,a){let e=await updatePkg(a,t);return {data:e.data,status:e.status}}async function w(t,a){let s=await updateGitPlugin(a,t?"git reset --hard HEAD && git pull --rebase":"git pull");return {data:s.data,status:s.status}}var R=m.command(/^#?(?:(?:柠糖)?表情)(?:插件)?(?:(强制|预览版))?更新$/i,async t=>{let a="failed",e="";if(c){let s=t.msg.includes("\u9884\u89C8\u7248")?"beta":"latest",o=await f(s,d.Plugin_Name);e=o.data,a=o.status;}else {let s=t.msg.includes("\u5F3A\u5236"),o=await w(s,d.Plugin_Path);a=o.status,e=o.data;}if(logger.debug(e),await t.bot.sendForwardMsg(t.contact,common.makeForward(JSON.stringify(e).slice(1,-1),t.bot.account.selfId,t.bot.account.name),{news:[{text:`\u66F4\u65B0${d.Plugin_Name}`}],prompt:`\u66F4\u65B0${d.Plugin_Name}`,summary:d.Plugin_Name,source:"\u66F4\u65B0\u63D2\u4EF6"}),a==="ok")try{return await t.reply(`
\u66F4\u65B0\u5B8C\u6210\uFF0C\u5F00\u59CB\u91CD\u542F \u672C\u6B21\u8FD0\u884C\u65F6\u95F4\uFF1A${common.uptime()}`,{reply:!0}),await restart(t.selfId,t.contact,t.messageId),!0}catch{await t.reply(`${d.Plugin_Name}\u91CD\u542F\u5931\u8D25\uFF0C\u8BF7\u624B\u52A8\u91CD\u542F\u4EE5\u5E94\u7528\u66F4\u65B0\uFF01`);}return  true},{name:"\u67E0\u7CD6\u8868\u60C5:\u66F4\u65B0",priority:-1/0,event:"message",permission:"master"}),v=m.command(/^#?(?:(?:柠糖)?表情)更新(表情包)?(资源|数据)?$/i,async t=>{try{return await t.reply("\u6B63\u5728\u66F4\u65B0\u8868\u60C5\u5305\u6570\u636E..."),await d$1.update_meme(!0),await d$1.update_preset(!0),await a(),await t.reply("\u8868\u60C5\u5305\u6570\u636E\u66F4\u65B0\u5B8C\u6210"),logger.mark(logger.chalk.rgb(255,165,0)("\u2705 \u8868\u60C5\u5305\u6570\u636E\u66F4\u65B0\u5B8C\u6210 \u{1F389}")),!0}catch(a){return await t.reply(`\u8868\u60C5\u5305\u6570\u636E\u66F4\u65B0\u5931\u8D25: ${a.message}`),logger.error(`\u8868\u60C5\u5305\u6570\u636E\u66F4\u65B0\u51FA\u9519: ${a.message}`),false}},{name:"\u67E0\u7CD6\u8868\u60C5:\u66F4\u65B0\u8868\u60C5\u5305\u8D44\u6E90",priority:-1/0,event:"message",permission:"master"}),I=e.other.autoUpdateRes&&m.task(`[${d.Plugin_AliasName}]:\u81EA\u52A8\u66F4\u65B0\u8868\u60C5\u8D44\u6E90`,e.other.autoUpdateResCron,async()=>{try{await d$1.update_meme(!0),await d$1.update_preset(!0);}catch(t){logger.error(`\u81EA\u52A8\u66F4\u65B0\u8868\u60C5\u5305\u8D44\u6E90\u51FA\u9519: ${t.message}`);}},{name:"\u67E0\u7CD6\u8868\u60C5:\u81EA\u52A8\u66F4\u65B0\u8868\u60C5\u5305\u8D44\u6E90",log:true});export{I as autoUpdateRes,R as update,v as updateRes};